<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>USDT ‚Üî WBTC Swap</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <h2>Connect Wallet & Swap Tokens</h2>
  <button onclick="connectWallet()">üîå Connect Wallet</button>
  <p id="walletStatus">Wallet not connected</p>

  <label>Token Contract Address:</label><br>
  <input type="text" id="tokenAddress" placeholder="e.g. 0xdAC17... (USDT)" size="50"><br><br>

  <label>Swap Direction:</label><br>
  <select id="swapDirection">
    <option value="usdtToWbtc">USDT ‚Üí WBTC</option>
    <option value="wbtcToUsdt">WBTC ‚Üí USDT</option>
  </select><br><br>

  <label>Amount to Swap:</label><br>
  <input type="text" id="amountIn" placeholder="Enter amount"><br><br>

  <button onclick="approveToken()">‚úÖ Approve</button>
  <button onclick="swapTokens()">üîÅ Swap</button>

  <script>
    let web3Provider, web3Signer;
    const UNISWAP_ROUTER = "0x7a250d5630b4cf539739df2c5dacb4c659f2488d"; // Uniswap V2 Router
    const USDT = "0xdAC17F958D2ee523a2206206994597C13D831ec7";
    const WBTC = "0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599";

    async function connectWallet() {
      if (window.ethereum) {
        await window.ethereum.request({ method: "eth_requestAccounts" });
        web3Provider = new ethers.providers.Web3Provider(window.ethereum);
        web3Signer = web3Provider.getSigner();
        const address = await web3Signer.getAddress();
        document.getElementById("walletStatus").innerText = "Connected: " + address;
      } else {
        alert("Please install MetaMask");
      }
    }

    async function approveToken() {
      const tokenAddr = document.getElementById("tokenAddress").value;
      const amount = ethers.utils.parseUnits(document.getElementById("amountIn").value, 18);
      const tokenAbi = ["function approve(address spender, uint amount) public returns (bool)"];
      const tokenContract = new ethers.Contract(tokenAddr, tokenAbi, web3Signer);
      const tx = await tokenContract.approve(UNISWAP_ROUTER, amount);
      await tx.wait();
      alert("Approval successful!");
    }

    async function swapTokens() {
      const direction = document.getElementById("swapDirection").value;
      const amountIn = ethers.utils.parseUnits(document.getElementById("amountIn").value, 18);
      const path = direction === "usdtToWbtc" ? [USDT, WBTC] : [WBTC, USDT];

      const routerAbi = [
        "function swapExactTokensForTokens(uint amountIn,uint amountOutMin,address[] calldata path,address to,uint deadline) external returns (uint[] memory amounts)"
      ];
      const router = new ethers.Contract(UNISWAP_ROUTER, routerAbi, web3Signer);
      const userAddress = await web3Signer.getAddress();

      const tx = await router.swapExactTokensForTokens(
        amountIn,
        0, // amountOutMin set to 0 for simplicity (not safe in real use!)
        path,
        userAddress,
        Math.floor(Date.now() / 1000) + 60 * 5
      );
      await tx.wait();
      alert("Swap complete!");
    }
  </script>
</body>
</html>
